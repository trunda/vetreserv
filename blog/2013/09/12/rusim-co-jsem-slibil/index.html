
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Grafika zraje, napíšu si komponentu - Reálná Ember.js aplikace</title>
  <meta name="author" content="Jakub Truneček">

  
  <meta name="description" content="Sliboval jsem, sliboval. Co jsem to sliboval? To že poodhalím grafickou podobu mojí skvělé aplikace. Dokonce jsem i první grafiku nakreslil, prozatím &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://trunda.github.io/vetreserv/blog/2013/09/12/rusim-co-jsem-slibil">
  <link href="/vetreserv/favicon.png" rel="icon">
  <link href="/vetreserv/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/vetreserv/atom.xml" rel="alternate" title="Reálná Ember.js aplikace" type="application/atom+xml">
  <script src="/vetreserv/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/vetreserv/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43836555-1']);
	_gaq.push(['_setDomainName','github.io']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><div id="header">
	<h1>Reálná aplikace v Ember.js</h1>
	<p>Vývoj reálné aplikace v Ember.js krok za krokem</p>
</div>
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/vetreserv/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:trunda.github.io/vetreserv" />
    <input class="search" type="text" name="q" results="0" placeholder="Vyhledávat"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/vetreserv/">Blog</a></li>
  <li><a href="/vetreserv/blog/archives">Archív</a></li>
  <li><a href="/vetreserv/ja">Něco málo o mně</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
  
    
      <h1 class="entry-title">Grafika zraje, napíšu si komponentu</h1>
    
  
    
      <p class="meta">
        








  


<time datetime="2013-09-12T00:00:00+02:00" pubdate data-updated="true">12. 09. 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Sliboval jsem, sliboval. Co jsem to sliboval? To že poodhalím grafickou podobu mojí skvělé aplikace. Dokonce jsem i první grafiku nakreslil, prozatím s ní ale nejsem úplně spokojen, je tomu prostě potřeba dát ještě trochu času. A proto přicházím s kompenzací.</p>

<p>Když jsem si připravoval inspiraci a materiály, rozhodl jsem se, že budu vycházet ze skvělého CSS frameworku od Twitteru, ano každý ho zná, je to <a href="http://getbootstrap.com">Bootsrap</a>. Ten v sobě obsahuje spoustu hezkých <a href="http://getbootstrap.com/css/#buttons">čudlátek</a>, <a href="http://getbootstrap.com/javascript/#carousel">hejbátek</a> a vůbec všech <a href="http://getbootstrap.com/components/">možných potřebností</a>.</p>

<!-- more -->

<p>Dokumentace hezky ukazuje, jak se pomocí klasických HTML prvků a tříd dá například z obyčejného <code>button</code> elementu udělat přenádherné tlačítko, určit mu barvičku, přidat mu ikonku a třeba i nastavit velikost. Je toho prostě spousta, co se takovým tlačítkem dá udělat. Jak toho všeho ale využít uvnitř Ember aplikace?</p>

<p>Jako první bude fajn si Boostrap nainstalovat do mého projektu. A to rovnou, novotou vonící, verzi s pořadovým číslem 3. Do <code>Gemfile</code> jsem přidal:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">gem</span> <span class="s1">&#39;anjlab-bootstrap-rails&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s1">&#39;bootstrap-rails&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="ss">:github</span> <span class="o">=&gt;</span> <span class="s1">&#39;anjlab/bootstrap-rails&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="ss">:branch</span> <span class="o">=&gt;</span> <span class="s1">&#39;3.0.0&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>a spustil bundler:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">~/vetserv<span class="nv">$ </span>bundle install
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Teď ještě Bootstrap přidám do do hlavního stylu tak, že ho přejmenuji z <code>application.css</code> na <code>application.css.scss</code> a vložím <code>@import "twitter/bootstrap";</code></p>

<h3 id="prvn-udltko">První čudlátko</h3>

<p>Říkám si: <em>“Chci velké červené tlačítko, na které když se klikne, něco se vypíše do konzole.”</em> Každý, kdo kdy použil jQuery, jistě tuší jak na to. Stop! Používám Ember.js, budu to dělat jinak! Jak? Takhle:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/templates/application.hbs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;h1&gt;</span>Ember.js<span class="nt">&lt;/h1&gt;</span>
</span><span class="line">    <span class="nt">&lt;hr/&gt;</span>
</span><span class="line">    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;btn btn-danger btn-lg&quot;</span> <span class="err">{{</span><span class="na">action</span> <span class="na">click</span><span class="err">}}</span><span class="nt">&gt;</span>Stiskni mě!<span class="nt">&lt;/button&gt;</span>
</span><span class="line"><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Po kliknutí to ale zatím nic neudělá, protože nemám napsanou akci v kontroléru, mohla by vypadat asi takto:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/controllers/application_controller.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="coffeescript"><span class="line"><span class="nv">Vetreserv.ApplicationController = </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">extend</span>
</span><span class="line">  <span class="nv">actions:</span>
</span><span class="line">    <span class="nv">click: </span><span class="nf">-&gt;</span>
</span><span class="line">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;něco&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>a voilà hop</p>

<p><img src="/vetreserv/images/rusim-co-jsem-slibil/01-button.jpg" title="Okno prohlížeče" /></p>

<h3 id="poaduji-dal-funknost">Požaduji další funkčnost</h3>

<p>Tohle bylo dost jednoduché, trochu si to ztížím: <em>“Navíc chci, aby po stisknutí tlačíka přešlo do tak zvaného loadingState a po 2 vteřinách se vrátilo zpět do stavu normálního.”</em> Nejdřív se sluší odkázat na to, <a href="http://getbootstrap.com/javascript/#buttons">co to loadingState je</a>. A teď hurá na to. Potřebuji:</p>

<ol>
  <li>proměnnou, která bude značit, že se něco načítá (<code>isLoading</code>),</li>
  <li>podle této proměnné zpodmínkovat text v tlačítku,</li>
  <li>stejně tak podle ní tlačítko z(ne)aktivňovat,</li>
  <li>nu a nakonec nastavit časovač, který vrátí proměnnou po 2 vteřinách zpět.</li>
</ol>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/controllers/application_controller.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="coffeescript"><span class="line"><span class="nv">Vetreserv.ApplicationController = </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">extend</span>
</span><span class="line">  <span class="nv">isLoading: </span><span class="kc">false</span>
</span><span class="line">  <span class="nv">actions:</span>
</span><span class="line">    <span class="nv">click: </span><span class="nf">-&gt;</span>
</span><span class="line">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;něco&#39;</span>
</span><span class="line">      <span class="nx">@set</span> <span class="s">&#39;isLoading&#39;</span><span class="p">,</span> <span class="kc">true</span>
</span><span class="line">      <span class="nx">setTimeout</span> <span class="o">=&gt;</span>
</span><span class="line">        <span class="nx">@set</span> <span class="s">&#39;isLoading&#39;</span><span class="p">,</span> <span class="kc">false</span>
</span><span class="line">      <span class="p">,</span> <span class="mi">2000</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/templates/application.hbs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;h1&gt;</span>Ember.js<span class="nt">&lt;/h1&gt;</span>
</span><span class="line">    <span class="nt">&lt;hr/&gt;</span>
</span><span class="line">    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;btn btn-danger btn-lg&quot;</span> <span class="err">{{</span><span class="na">action</span> <span class="na">click</span><span class="err">}}</span> <span class="err">{{</span><span class="na">bind-attr</span> <span class="na">disabled=</span><span class="s">isLoading}}</span><span class="nt">&gt;</span>
</span><span class="line">        {{#if isLoading}}
</span><span class="line">        Načítám ...
</span><span class="line">        {{else}}
</span><span class="line">        Stiskni mě!
</span><span class="line">        {{/if}}
</span><span class="line">    <span class="nt">&lt;/button&gt;</span>
</span><span class="line"><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="/vetreserv/images/rusim-co-jsem-slibil/02-button.jpg" title="Okno prohlížeče" /></p>

<h3 id="znovupouitelnost-roziitelnost">Znovupoužitelnost? Rozšiřitelnost?</h3>

<p>Omnomnom, krásně mi to všechno funguje. Koukám do dokumentace Bootstrapu, co vše by ještě to moje tlačítko mohlo umět a představuji si, jak bych kód šablony doplňoval a nafukoval. Pokud bych chtěl mít i jinde podobně mocná tlačítka, kód bych kopíroval tam a sem a taky kousek tuhle a támhle. </p>

<p>Mezi tím vším kopírovaním, při mém štěstí, by si určitě kluci z Twittru rozmysleli, že třída <code>btn</code> je málo výmluvná a přejmenovali by ji v další verzi na <code>button</code>. Já, natěšen na nové krásné nevímco, bych samozřejmě mezi prvními upgradoval a … ježkovi zraky! To to jako mám všude přepsat?</p>

<p>Tu přichází ta kompezace z úvodu. Moje programátorské svědomí celkem jasně velí toto multifunkční tlačítko hezky zabalit do komponenty a světu vystavit na odiv jen jeho rozhraní. Ona kompenzace spočívá v tom, že se zde o tuto komponentu podělím v podobě step-by-step postupu jejího zrození.</p>

<h3 id="rozhran-tlatka">Rozhraní tlačítka</h3>

<p>Tlačítko bude <a href="http://emberjs.com/api/classes/Ember.View.html">View</a> s následujícími vlastnostmi (všechny jsou volitelné, to zanemená že je lze zcela vynechat).</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="html"><span class="line">{{ view Vetreserv.ButtonView
</span><span class="line">	
</span><span class="line">	text		= &quot;Text tlačítka&quot;
</span><span class="line">	type		= &quot;default|primary|success|info|warning|danger|link&quot;
</span><span class="line">	size		= &quot;lg|sm|xs&quot;
</span><span class="line">	loadingText	= &quot;Text tlačítka v loading state&quot;
</span><span class="line">	isLoading	= true|false
</span><span class="line">	icon		= &quot;nazev_ikonky&quot;
</span><span class="line">	disabled	= false|true
</span><span class="line">	block		= true|false
</span><span class="line">	action		= &quot;nazev_akce&quot;
</span><span class="line">}}
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="zkladn-view">Základní view</h3>

<p>Začnu tím jednoduchým, bude se snažit vykreslit jednoduché tlačítko.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/views/button_view.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="coffeescript"><span class="line"><span class="nv">bootstrapClass = </span><span class="s">&#39;btn&#39;</span>
</span><span class="line"><span class="nv">Vetreserv.ButtonView = </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span>
</span><span class="line">  <span class="nv">tagName: </span><span class="s">&#39;button&#39;</span>
</span><span class="line">
</span><span class="line">  <span class="nv">classNameBindings: </span><span class="p">[</span><span class="s">&quot;:</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">&quot;</span><span class="p">]</span>
</span><span class="line">
</span><span class="line">  <span class="nv">render: </span><span class="nf">(buffer) -&gt;</span>
</span><span class="line">    <span class="nx">buffer</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/templates/application.hbs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;h1&gt;</span>Ember.js<span class="nt">&lt;/h1&gt;</span>
</span><span class="line">    <span class="nt">&lt;hr/&gt;</span>
</span><span class="line">    {{view Vetreserv.ButtonView text=&quot;Stiskni mě!&quot;}}
</span><span class="line"><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="/vetreserv/images/rusim-co-jsem-slibil/03-button.jpg" title="Okno prohlížeče" /></p>

<p>Myslím, že je zbytečné vysvětlovat jednotlivé řádky a vlastnosti v mé nové třídě a to zejména proto, že v dokumentaci Emberu.js je vše detailně popsáno. Tady jsou jednotlivé odkazy do dokumentace:</p>

<ol>
  <li><a href="http://emberjs.com/api/classes/Ember.View.html#property_tagName">vlastnost <code>tagName</code></a></li>
  <li><a href="http://emberjs.com/api/classes/Ember.View.html#property_classNameBindings">vlastnost <code>classNameBindings</code></a></li>
  <li><a href="http://emberjs.com/api/classes/Ember.View.html#method_render">metoda <code>render</code></a></li>
</ol>

<p><a id="dej-si-facku"></a> Zajímavé je, proč používám metodu <code>render</code>, když mohu jednoduše použít šablonu. <a href="http://eviltrout.com/2013/04/01/adding-to-discourse-part-3.html">Někde jsem četl</a>, že je to výkonější a v tomto případě, kdy renderujeme jen text uvnitř tlačítka, je to stále jednoduché a čitelné. Na druhou stranu, je nutné si uvědomit, že ztracím kouzlo vazeb a tím i kouzlo automatického překreslení v závislosti na změnách proměnných. Na to ostatně narazím později (hlavně na to nezapomenout) a budu se s tím muset nějka poprat.</p>

<h3 id="velikost-typ-a-zorabzen-na-celou-ku">Velikost, typ a zorabzení na celou šířku</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/views/button_view.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class="coffeescript"><span class="line"><span class="nv">bootstrapClass = </span><span class="s">&#39;btn&#39;</span>
</span><span class="line"><span class="nv">Vetreserv.ButtonView = </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span>
</span><span class="line">  <span class="nv">tagName: </span><span class="s">&#39;button&#39;</span>
</span><span class="line">  <span class="nv">type: </span><span class="s">&#39;default&#39;</span>
</span><span class="line">
</span><span class="line">  <span class="nv">classNameBindings: </span><span class="p">[</span><span class="s">&quot;:</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;typeClass&quot;</span><span class="p">,</span> <span class="s">&quot;sizeClass&quot;</span><span class="p">,</span> <span class="s">&quot;blockClass&quot;</span><span class="p">]</span>
</span><span class="line">
</span><span class="line">  <span class="nv">typeClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-</span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">sizeClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="k">if</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-</span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">else</span> <span class="kc">null</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">blockClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="k">if</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;block&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-block&quot;</span> <span class="k">else</span> <span class="kc">null</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;block&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">render: </span><span class="nf">(buffer) -&gt;</span>
</span><span class="line">    <span class="nx">buffer</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/templates/application.hbs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;h1&gt;</span>Ember.js<span class="nt">&lt;/h1&gt;</span>
</span><span class="line">    <span class="nt">&lt;hr/&gt;</span>
</span><span class="line">    {{view Vetreserv.ButtonView text=&quot;Stiskni mě!&quot; type=&quot;danger&quot; size=&quot;lg&quot;}}
</span><span class="line">    <span class="nt">&lt;br</span> <span class="nt">/&gt;&lt;br</span> <span class="nt">/&gt;</span>
</span><span class="line">    {{view Vetreserv.ButtonView block=true text=&quot;Stiskni mě!&quot;}}
</span><span class="line"><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="/vetreserv/images/rusim-co-jsem-slibil/04-button.jpg" title="Okno prohlížeče" /></p>

<p>Jak tohle vlastně funguje? Použil jsem, co jsem již jednou ukázal, konkrétně <a href="http://emberjs.com/api/classes/Ember.View.html#property_classNameBindings">vlastnost <code>classNameBindings</code></a> dle instrukcí v dokumentaci. Tím jsem vytvořil vazby mezi třídou elementu a vlastností view. Protože nemohu použít klasické statické vlastnosti, ale musím je poskládat dle Boostrap dokumentace, využil jsem další zajímavé funkčnosti Ember.js a tou jsou <a href="http://emberjs.com/guides/object-model/computed-properties/">počítané vlastnosti</a>. Jsou to vlastně fuknce, které se tváří jako vlastnosti. Navíc se šetrně ukládají do mezipaměti a invalidují se v okamžiku, kdy se změní jedna z vlastností, na které jsou závislé. Paráda.</p>

<h3 id="ikonka">Ikonka</h3>

<p>Tohle je už trochu těžší kalibr. Hlavně proto, že ikonku může přeci mít více prvků, nejen tlačítko, musím tedy aplikovat <abbr title="Don't Repeat Yourself">DRY</abbr> a napsat to tak, aby bylo možno ikonku použít i u jiných prvků. <a href="https://www.google.cz/search?q=alz%C3%A1k&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ei=on8wUunJKYS57Aag_oGAAg&amp;ved=0CAcQ_AUoAQ&amp;biw=1463&amp;bih=987">Alzák</a> by zvolal “Tamtadadáááá” a obratem by mi prodal <a href="http://emberjs.com/api/classes/Ember.Mixin.html">Ember.Mixin</a> za super baťovskou cenu, protože přesně ten nyní potřebuji.</p>

<p>Mixin bude velmi jednoduchý, přidá jednu metodu pro renderování ikonky <code>renderIcon</code>, za jejíž volání bude zodpovědná třída (<code>View</code>), která daný Mixin bude používat.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/mixins/icon_aware_mixin.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="coffeescript"><span class="line"><span class="nv">Vetreserv.IconAwareMixin = </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">Mixin</span><span class="p">.</span><span class="nx">create</span>
</span><span class="line">  <span class="nv">renderIcon: </span><span class="nf">(buffer) -&gt;</span>
</span><span class="line">    <span class="nx">buffer</span><span class="p">.</span><span class="nx">push</span> <span class="s">&quot;&lt;i class=\&quot;glyphicon glyphicon-</span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;icon&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">\&quot;&gt;&lt;/i&gt;&amp;nbsp;&quot;</span> <span class="k">if</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;icon&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/views/button_view.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
</pre></td><td class="code"><pre><code class="coffeescript"><span class="line"><span class="nv">bootstrapClass = </span><span class="s">&#39;btn&#39;</span>
</span><span class="line"><span class="nv">Vetreserv.ButtonView = </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Vetreserv</span><span class="p">.</span><span class="nx">IconAwareMixin</span><span class="p">,</span>
</span><span class="line">  <span class="nv">tagName: </span><span class="s">&#39;button&#39;</span>
</span><span class="line">  <span class="nv">type: </span><span class="s">&#39;default&#39;</span>
</span><span class="line">
</span><span class="line">  <span class="nv">classNameBindings: </span><span class="p">[</span><span class="s">&quot;:</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;typeClass&quot;</span><span class="p">,</span> <span class="s">&quot;sizeClass&quot;</span><span class="p">,</span> <span class="s">&quot;blockClass&quot;</span><span class="p">]</span>
</span><span class="line">
</span><span class="line">  <span class="nv">typeClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-</span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">sizeClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="k">if</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-</span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">else</span> <span class="kc">null</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">blockClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="k">if</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;block&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-block&quot;</span> <span class="k">else</span> <span class="kc">null</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;block&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">render: </span><span class="nf">(buffer) -&gt;</span>
</span><span class="line">    <span class="nx">@renderIcon</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span>
</span><span class="line">    <span class="nx">buffer</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/templates/application.hbs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;h1&gt;</span>Ember.js<span class="nt">&lt;/h1&gt;</span>
</span><span class="line">    <span class="nt">&lt;hr/&gt;</span>
</span><span class="line">    {{view Vetreserv.ButtonView text=&quot;Stiskni mě!&quot; type=&quot;danger&quot; size=&quot;lg&quot; icon=&quot;star&quot;}}
</span><span class="line"><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="/vetreserv/images/rusim-co-jsem-slibil/05-button.jpg" title="Okno prohlížeče" /></p>

<h3 id="a-co-voln-akce">A co volání akce?</h3>

<p>Mám sice přepěkné tlačítko, ale jaksi se nedá moc použít, protože neumí zavolat akci v kontroléru. Tady je třeba trochu pátrat, aby toho jeden byl schopen dosáhnout – ale kdo hledá, najde <a href="http://emberjs.com/api/classes/Ember.ViewTargetActionSupport.html">Ember.ViewTargetActionSupport</a> a pak už je to hračka. Navíc jsem využil faktu, že pokud view implementuje metodu, která se jmenuje stejně jako akce z jQuery (takové to <code>click</code>, <code>doubleClick</code> a spol.), je tato akce na daný view kontejner připojena.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/views/button_view.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
</pre></td><td class="code"><pre><code class="coffeescript"><span class="line"><span class="nv">bootstrapClass = </span><span class="s">&#39;btn&#39;</span>
</span><span class="line"><span class="nv">Vetreserv.ButtonView = </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Vetreserv</span><span class="p">.</span><span class="nx">IconAwareMixin</span><span class="p">,</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">ViewTargetActionSupport</span><span class="p">,</span>
</span><span class="line">  <span class="nv">tagName: </span><span class="s">&#39;button&#39;</span>
</span><span class="line">  <span class="nv">type: </span><span class="s">&#39;default&#39;</span>
</span><span class="line">
</span><span class="line">  <span class="nv">classNameBindings: </span><span class="p">[</span><span class="s">&quot;:</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;typeClass&quot;</span><span class="p">,</span> <span class="s">&quot;sizeClass&quot;</span><span class="p">,</span> <span class="s">&quot;blockClass&quot;</span><span class="p">]</span>
</span><span class="line">
</span><span class="line">  <span class="nv">typeClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-</span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">sizeClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="k">if</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-</span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">else</span> <span class="kc">null</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">blockClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="k">if</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;block&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-block&quot;</span> <span class="k">else</span> <span class="kc">null</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;block&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">render: </span><span class="nf">(buffer) -&gt;</span>
</span><span class="line">    <span class="nx">@renderIcon</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span>
</span><span class="line">    <span class="nx">buffer</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">click: </span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="nx">@triggerAction</span><span class="p">()</span>
</span><span class="line">    <span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/templates/application.hbs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;h1&gt;</span>Ember.js<span class="nt">&lt;/h1&gt;</span>
</span><span class="line">    <span class="nt">&lt;hr/&gt;</span>
</span><span class="line">    {{view Vetreserv.ButtonView text=&quot;Stiskni mě!&quot; type=&quot;danger&quot; size=&quot;lg&quot; icon=&quot;star&quot; action=&quot;handleClick&quot;}}
</span><span class="line"><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/controllers/application_controller.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="coffeescript"><span class="line"><span class="nv">Vetreserv.ApplicationController = </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">extend</span>
</span><span class="line">  <span class="nv">actions:</span>
</span><span class="line">    <span class="nv">handleClick: </span><span class="nf">-&gt;</span>
</span><span class="line">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;něco&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="/vetreserv/images/rusim-co-jsem-slibil/06-button.jpg" title="Okno prohlížeče" /></p>

<h3 id="to-nejlep-nakonec----loadingstate">To nejlepší nakonec – LoadingState</h3>

<p>Když jsem se nad tím zamyslel, vyšlo mi, co všechno vlastně potřebuji jako vstup:</p>

<ol>
  <li>text, který se má zobrazit při načítání,</li>
  <li>proměnnou, která mi bude načítací stav indikovat.</li>
</ol>

<p>Z algoritmického pohledu pak bude komponenta fungovat tak, že text do tlačítka se bude vypisovat podle toho, jak je nastavena proměnná indikující načítací stav a stejně tak se bude přidávat nebo odebírat <code>disabled</code> <abbr title="Proč dvě t? Jsem z tý angličtiny trochu poblblej.">attribut</abbr> . Udělal jsem tedy úpravu komponenty:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/views/button_view.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
</pre></td><td class="code"><pre><code class="coffeescript"><span class="line"><span class="nv">bootstrapClass = </span><span class="s">&#39;btn&#39;</span>
</span><span class="line"><span class="nv">Vetreserv.ButtonView = </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Vetreserv</span><span class="p">.</span><span class="nx">IconAwareMixin</span><span class="p">,</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">ViewTargetActionSupport</span><span class="p">,</span>
</span><span class="line">  <span class="nv">tagName: </span><span class="s">&#39;button&#39;</span>
</span><span class="line">  <span class="nv">type: </span><span class="s">&#39;default&#39;</span>
</span><span class="line">  <span class="nv">isLoading: </span><span class="kc">false</span>
</span><span class="line">
</span><span class="line">  <span class="nv">classNameBindings: </span><span class="p">[</span><span class="s">&quot;:</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;typeClass&quot;</span><span class="p">,</span> <span class="s">&quot;sizeClass&quot;</span><span class="p">,</span> <span class="s">&quot;blockClass&quot;</span><span class="p">]</span>
</span><span class="line">  <span class="nv">attributeBindings: </span><span class="p">[</span><span class="s">&#39;disabledAttr:disabled&#39;</span><span class="p">]</span>
</span><span class="line">
</span><span class="line">  <span class="nv">typeClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-</span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">sizeClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="k">if</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-</span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">else</span> <span class="kc">null</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">blockClass: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="k">if</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;block&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">bootstrapClass</span><span class="si">}</span><span class="s">-block&quot;</span> <span class="k">else</span> <span class="kc">null</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;block&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">disabledAttr: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;isLoading&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;disabled&#39;</span><span class="p">)</span>
</span><span class="line">  <span class="p">).</span><span class="nx">property</span><span class="p">(</span><span class="s">&#39;disabled&#39;</span><span class="p">,</span> <span class="s">&#39;isLoading&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="nv">render: </span><span class="nf">(buffer) -&gt;</span>
</span><span class="line">    <span class="nx">@renderIcon</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span>
</span><span class="line">    <span class="k">if</span> <span class="o">!</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;isLoading&#39;</span><span class="p">)</span>
</span><span class="line">      <span class="nv">text = </span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">)</span>
</span><span class="line">    <span class="k">else</span> <span class="k">if</span> <span class="o">!</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;loadingText&#39;</span><span class="p">)</span>
</span><span class="line">      <span class="nv">text = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">)</span><span class="si">}</span><span class="s"> ...&quot;</span>
</span><span class="line">    <span class="k">else</span>
</span><span class="line">      <span class="nv">text = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@get</span><span class="p">(</span><span class="s">&#39;loadingText&#39;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span>
</span><span class="line">    <span class="nx">buffer</span><span class="p">.</span><span class="nx">push</span> <span class="nx">text</span>
</span><span class="line">
</span><span class="line">  <span class="nv">click: </span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="nx">@triggerAction</span><span class="p">()</span>
</span><span class="line">    <span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/templates/application.hbs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nt">&lt;h1&gt;</span>Ember.js<span class="nt">&lt;/h1&gt;</span>
</span><span class="line">    <span class="nt">&lt;hr/&gt;</span>
</span><span class="line">    {{view Vetreserv.ButtonView text=&quot;Stiskni mě!&quot;
</span><span class="line">        type=&quot;danger&quot; size=&quot;lg&quot; icon=&quot;star&quot; action=&quot;handleClick&quot;
</span><span class="line">        isLoadingBinding=isLoading}}
</span><span class="line"><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/controllers/application_controller.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="coffeescript"><span class="line"><span class="nv">Vetreserv.ApplicationController = </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">extend</span>
</span><span class="line">  <span class="nv">isLoading: </span><span class="kc">false</span>
</span><span class="line">  <span class="nv">actions:</span>
</span><span class="line">    <span class="nv">handleClick: </span><span class="nf">-&gt;</span>
</span><span class="line">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;něco&#39;</span>
</span><span class="line">      <span class="nx">@set</span> <span class="s">&#39;isLoading&#39;</span><span class="p">,</span> <span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="/vetreserv/images/rusim-co-jsem-slibil/07-button.jpg" title="Okno prohlížeče" /></p>

<p>Super, to je mi ale … počkat! Tlačítko sice je disablované, ale nezměnil se mi text tlačítka! A teď to přichází, několik desítek minut střídavě ladím, refreshuji, vypisuji do konzole a nadávám. Poté si vzpomenu, jak <a href="#dej-si-facku">jsem se výše zmiňoval</a> o nedostatku použití metody <code>render</code> pro vykreslování a okamžitě si dávám takovou facku, že mi na okamžik slézají uši na jednu stranu hlavy. No nic, příště si udělám uzel na kabelu od mé <a href="http://www.apple.com/magicmouse/">Apple Wireless MagicMouse</a>.</p>

<p>Existují dvě možnosti, jak to vyřešit. První je, přestat používat metodu render a místo toho použít šablonu, která se bude sama překreslovat. To bych ale musel upravit i mixin pro ikonku (což stejně budu muset později asi udělat) a navíc mám rád seriál How I Met Your Mother – <em>“Challenge accepted!”</em>. Druhou možností, která mi navíc trochu rozšíří obzory, je <a href="http://emberjs.com/guides/object-model/observers/">použití observerů</a>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>vetreserv/app/assets/javascripts/views/button_view.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="coffeescript"><span class="line"><span class="nv">bootstrapClass = </span><span class="s">&#39;btn&#39;</span>
</span><span class="line"><span class="nv">Vetreserv.ButtonView = </span><span class="nx">Ember</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Vetreserv</span><span class="p">.</span><span class="nx">IconAwareMixin</span><span class="p">,</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">ViewTargetActionSupport</span><span class="p">,</span>
</span><span class="line">  <span class="c1"># ...</span>
</span><span class="line">
</span><span class="line">  <span class="nv">isLoadingChanged: </span><span class="p">(</span><span class="nf">-&gt;</span>
</span><span class="line">    <span class="nx">@rerender</span><span class="p">()</span>
</span><span class="line">  <span class="p">).</span><span class="nx">observes</span><span class="p">(</span><span class="s">&#39;isLoading&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img src="/vetreserv/images/rusim-co-jsem-slibil/08-button.jpg" title="Okno prohlížeče" /></p>

<h3 id="a-je-to">A je to!</h3>

<p>Jsem na sebe hrdý! Tlačítko jak z alabastru a padla u toho jen jedna facka.</p>

<h3 id="odkazy">Odkazy</h3>

<ul>
  <li><a href="https://github.com/trunda/vetreserv/tree/02-komponenta">zdrojové kódy</a></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Autor: <span class="fn">Jakub Truneček</span></span>

      








  


<time datetime="2013-09-12T00:00:00+02:00" pubdate data-updated="true">12. 09. 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://trunda.github.io/vetreserv/blog/2013/09/12/rusim-co-jsem-slibil/" data-via="jtrunecek" data-counturl="http://trunda.github.io/vetreserv/blog/2013/09/12/rusim-co-jsem-slibil/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/vetreserv/blog/2013/09/06/navrh-veledila-a-priprava-podhoubi/" title="Previous Post: Návrh veledíla a příprava podhoubí">&laquo; Návrh veledíla a příprava podhoubí</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Komentáře</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/vetreserv/blog/2013/09/12/rusim-co-jsem-slibil/">Grafika zraje, napíšu si komponentu</a>
      </li>
    
      <li class="post">
        <a href="/vetreserv/blog/2013/09/06/navrh-veledila-a-priprava-podhoubi/">Návrh veledíla a příprava podhoubí</a>
      </li>
    
      <li class="post">
        <a href="/vetreserv/blog/2013/09/03/proc-tenhle-blog/">Proč tenhle blog?</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Jakub Truneček <br/>
  <span class="credit">Používám <a href="http://octopress.org">Octopress</a>, společně s <a href="https://github.com/mjhea0/whiterspace">whiterspace</a>.</span> <br />
  <span class="credit"><a href="https://github.com/trunda/vetreserv">Zdrojové kódy</a> pro rezervační systém (vždy aktuální k poslednímu článku)</span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'vetreserv';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://trunda.github.io/vetreserv/blog/2013/09/12/rusim-co-jsem-slibil/';
        var disqus_url = 'http://trunda.github.io/vetreserv/blog/2013/09/12/rusim-co-jsem-slibil/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
